(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[123],{1474:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>E});var t=a(5155),r=a(2115),n=a(5695),l=a(2843),c=a(285),o=a(6695),i=a(2346),d=a(2302);let m=(0,d.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var u=a(4186),x=a(3453);let p=(0,d.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),h=(0,d.A)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var f=a(6474),g=a(6671),j=a(9434),v=a(1207);let N="sk_live_94650bee9996e1d54b0007ebc6c58cb51a7074b9f2ec8e3497a12440a984f9cd",y="https://api.blackcatpagamentos.online/api";function b(e){return e.replace(/\D/g,"")}let w={name:"Cliente Teste Sushiaki",email:"teste@sushiaki.com",phone:"41999999999",document:"12345678901"};async function C(e){try{console.log("Creating PIX transaction with order:",e);let s=function(e){var s,a,t,r,n;let l=e&&e.total&&!(e.total<=0)?e.items&&0!==e.items.length?{valid:!0}:{valid:!1,error:"Itens do pedido s\xe3o obrigat\xf3rios"}:{valid:!1,error:"Valor do pedido inv\xe1lido"};if(!l.valid)throw Error(l.error);let c=e.total,o=Math.round(100*c);console.log("Calculated total amount: R$".concat(c.toFixed(2)," = ").concat(o," cents"));let i={name:(null==(s=e.customer)?void 0:s.name)||w.name,street:e.address.street,number:e.address.number,complement:e.address.complement||"",neighborhood:e.address.neighborhood,city:e.address.city,state:e.address.state,zipCode:e.address.cep.replace(/\D/g,"")};return{amount:o,currency:"BRL",paymentMethod:"pix",items:e.items.map(e=>{var s,a;let t=Math.round(100*((null==(a=e.details)||null==(s=a.selectedVariation)?void 0:s.option.price)||e.price));return{title:e.name,quantity:e.quantity,unitPrice:t,tangible:!0}}),customer:{name:(null==(a=e.customer)?void 0:a.name)||w.name,email:(null==(t=e.customer)?void 0:t.email)||w.email,phone:b((null==(r=e.customer)?void 0:r.phone)||w.phone),document:{type:"cpf",number:b((null==(n=e.customer)?void 0:n.cpf)||w.document)}},shipping:i,pix:{expiresInDays:1},externalRef:e.id||"PEDIDO-".concat(Date.now()),metadata:JSON.stringify({orderId:e.id,timestamp:new Date().toISOString()})}}(e);console.log("Enviando payload para Blackcat Pay:",JSON.stringify(s,null,2));let a=await fetch("".concat(y,"/sales/create-sale"),{method:"POST",headers:{"X-API-Key":N,"Content-Type":"application/json"},body:JSON.stringify(s)});console.log("API Response status:",a.status);let t=await a.text();if(console.log("API Response text:",t),!a.ok){let e="Erro na API Blackcat Pay: ".concat(a.status," ").concat(a.statusText);try{let s=JSON.parse(t);s.message&&(e+=". Mensagem: ".concat(s.message)),s.error&&(e+=". Erro: ".concat(s.error))}catch(s){e+=". Resposta: ".concat(t)}throw console.error(e),Error(e)}let r=JSON.parse(t);if(!r.success||!r.data)throw Error("Resposta da API inv\xe1lida: sucesso=false ou dados ausentes");let n=r.data;return console.log("Transaction created successfully:",n),{success:!0,transactionId:n.transactionId,qrCode:n.paymentData.qrCodeBase64,qrCodeUrl:null,pixKey:n.paymentData.copyPaste,expiresAt:n.paymentData.expiresAt,amount:e.total,transactionData:n}}catch(e){return console.error("Error in createPixTransaction:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}async function k(e){try{let s=await fetch("".concat(y,"/sales/").concat(e,"/status"),{method:"GET",headers:{"X-API-Key":N,"Content-Type":"application/json"}});if(!s.ok){let e=await s.json().catch(()=>({}));throw console.error("Error checking payment status:",e),Error(e.message||"HTTP error! status: ".concat(s.status))}let a=(await s.json()).data;return{success:!0,status:a.status.toLowerCase(),amount:a.amount/100,paidAt:a.paidAt}}catch(e){return console.error("Error in checkPaymentStatus:",e),{success:!1,error:e instanceof Error?e.message:"Erro desconhecido"}}}var P=a(6766);let I=e=>{let s=Math.floor(e/60);return"".concat(String(s).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))};function E(){let e=(0,n.useRouter)(),s=(0,n.useSearchParams)(),{items:a,getTotalPrice:d,clearCart:N}=(0,v.x)(),[y,b]=(0,r.useState)(null),[w,E]=(0,r.useState)(null),[A,S]=(0,r.useState)("pending"),[R,T]=(0,r.useState)(600),[O,X]=(0,r.useState)(!0),[D,q]=(0,r.useState)(null),[$,V]=(0,r.useState)(!1),Z=r.useRef(null),z=I(R);(0,r.useEffect)(()=>{try{let e=s.get("order");if(e){let s=JSON.parse(decodeURIComponent(e));b(s),B(s)}else q({message:"Nenhum dado de pedido encontrado"}),X(!1)}catch(e){q({message:e instanceof Error?e.message:"Dados do pedido inv\xe1lidos"}),X(!1),console.error("Error parsing order data:",e)}},[s]),(0,r.useEffect)(()=>{if("pending"!==A||R<=0){R<=0&&"pending"===A&&S("expired");return}let e=setInterval(()=>{T(s=>s<=1?(clearInterval(e),0):s-1)},1e3);return()=>clearInterval(e)},[A,R]);let B=async e=>{try{X(!0),console.log("Creating transaction with order:",e);let r=await C(e);if(r.success){var s,a,t;let e,n;E(r),S("pending"),T(600);let l=(s=r.transactionId,a=e=>{S("approved"),E(s=>({...s,paidAt:e.paidAt}))},t=e=>{S("error"),q({message:e})},n=0,e=setInterval(async()=>{n++;let r=await k(s);if(r.success){console.log("Payment status check ".concat(n,":"),r.status);let s=r.status;"paid"===s||"approved"===s?(console.log("✓ Pagamento confirmado!"),clearInterval(e),a(r)):("cancelled"===s||"declined"===s)&&(console.log("✗ Pagamento cancelado/recusado"),clearInterval(e),t("Pagamento cancelado"))}else console.error("Error checking payment status:",r.error),n>=120&&(clearInterval(e),t("Timeout ao verificar pagamento"))},5e3),()=>{clearInterval(e)});return()=>{l()}}q({message:r.error||"Falha ao criar transa\xe7\xe3o PIX",details:"response"in r?r.response:void 0,status:"status"in r?Number(r.status):void 0}),S("error"),console.error("Transaction creation failed:",r.error)}catch(e){q({message:e instanceof Error?e.message:"Erro desconhecido",details:e}),S("error"),console.error("Unexpected error in createTransaction:",e)}finally{X(!1)}},_=()=>{e.push("/checkout")},J=()=>{N(),e.push("/")};if(O)return(0,t.jsx)(l.O,{children:(0,t.jsx)("div",{className:"container mx-auto p-4 md:p-6 min-h-[80vh] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center space-y-4",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),(0,t.jsx)("p",{className:"text-lg font-semibold text-foreground",children:"Processando seu pagamento..."}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Aguarde enquanto geramos sua chave PIX"})]})})});if(D)return(0,t.jsx)(l.O,{children:(0,t.jsx)("div",{className:"container mx-auto p-4 md:p-6 min-h-[80vh] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center space-y-4 max-w-md",children:[(0,t.jsx)("div",{className:"bg-destructive/10 p-4 rounded-full inline-block",children:(0,t.jsx)(m,{className:"h-12 w-12 text-destructive"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-destructive",children:"Erro no Pagamento"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:D.message}),D.details&&(0,t.jsxs)("div",{className:"text-left text-sm text-muted-foreground bg-destructive/5 p-4 rounded-lg mt-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-destructive mb-2",children:"Detalhes do erro:"}),(0,t.jsx)("pre",{className:"overflow-x-auto",children:JSON.stringify(D.details,null,2)}),D.status&&(0,t.jsxs)("p",{className:"mt-2",children:["C\xf3digo de status: ",D.status]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.$,{onClick:_,className:"w-full",children:"Tentar novamente"}),(0,t.jsx)(c.$,{onClick:J,variant:"outline",className:"w-full",children:"Voltar para o in\xedcio"})]})]})})});if(!w||!w.pixKey)return(0,t.jsx)(l.O,{children:(0,t.jsx)("div",{className:"container mx-auto p-4 md:p-6 min-h-[80vh] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center space-y-4 max-w-md",children:[(0,t.jsx)("div",{className:"bg-destructive/10 p-4 rounded-full inline-block",children:(0,t.jsx)(m,{className:"h-12 w-12 text-destructive"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-destructive",children:"Erro no Pagamento"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"N\xe3o foi poss\xedvel obter a chave PIX. Tente novamente."}),(0,t.jsx)(c.$,{onClick:_,className:"w-full",children:"Voltar para o checkout"})]})})});let K=w.pixKey.substring(0,40)+"...";return(0,t.jsx)(l.O,{children:(0,t.jsx)("div",{className:"container mx-auto p-4 md:p-6 min-h-[80vh]",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"relative h-10 w-24 mx-auto mb-2",children:(0,t.jsx)(P.default,{src:"/images/pix-logo-full.png",alt:"Logo PIX",layout:"fill",objectFit:"contain"})}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground",children:"Pagamento via PIX"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Copie a chave PIX para pagar"})]}),(0,t.jsxs)("div",{className:"flex justify-center",children:["pending"===A&&(0,t.jsxs)("div",{className:"bg-yellow-500/10 p-3 rounded-full inline-flex items-center gap-2",children:[(0,t.jsx)(u.A,{className:"h-5 w-5 text-yellow-500"}),(0,t.jsx)("span",{className:"font-medium text-yellow-600",children:"Aguardando pagamento"})]}),"approved"===A&&(0,t.jsxs)("div",{className:"bg-success/10 p-3 rounded-full inline-flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-5 w-5 text-success"}),(0,t.jsx)("span",{className:"font-medium text-success",children:"Pagamento confirmado!"})]}),"expired"===A&&(0,t.jsxs)("div",{className:"bg-destructive/10 p-3 rounded-full inline-flex items-center gap-2",children:[(0,t.jsx)(m,{className:"h-5 w-5 text-destructive"}),(0,t.jsx)("span",{className:"font-medium text-destructive",children:"QR Code expirado"})]})]}),"pending"===A&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"inline-flex items-center gap-2 bg-muted p-2 rounded-lg",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-mono text-lg font-semibold text-foreground",children:z})]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Tempo restante para pagar"})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,t.jsx)("div",{className:"bg-primary h-2.5 rounded-full transition-all duration-1000 ease-linear",style:{width:"".concat(R/600*100,"%")}})})]}),(0,t.jsxs)(o.Zp,{className:"bg-white shadow-lg",children:[(0,t.jsx)(o.aR,{className:"pb-3",children:(0,t.jsxs)(o.ZB,{className:"text-xl font-semibold flex items-center justify-between",children:["Chave PIX (Copia e Cola)",(0,t.jsxs)(c.$,{variant:"ghost",size:"lg",onClick:()=>{(null==w?void 0:w.pixKey)&&(navigator.clipboard.writeText(w.pixKey),g.oR.success("Chave PIX copiada para a \xe1rea de transfer\xeancia!"))},className:"text-green-700 hover:text-green-800 text-lg font-bold animate-slow-pulse",children:[(0,t.jsx)(p,{className:"h-5 w-5 mr-2"})," Copiar Chave"]})]})}),(0,t.jsxs)(o.Wu,{className:"pt-0",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground break-all font-mono bg-muted p-3 rounded-md",children:K}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Copie esta chave e cole na \xe1rea PIX Copia e Cola do aplicativo do seu banco para pagar."})]}),(0,t.jsx)(c.$,{variant:"link",onClick:()=>{Z.current&&Z.current.scrollIntoView({behavior:"smooth",block:"start"})},className:"p-0 h-auto mt-4 text-blue-800 hover:text-blue-900 font-semibold",children:"N\xe3o sabe como pagar? Clique aqui!"})]})]}),(0,t.jsx)("div",{className:"fixed right-4 top-1/2 transform -translate-y-1/2 z-10",children:(0,t.jsx)(c.$,{variant:"outline",size:"icon",className:"rounded-full h-12 w-12 shadow-lg",onClick:()=>V(!$),children:$?(0,t.jsx)(h,{className:"h-5 w-5"}):(0,t.jsx)(f.A,{className:"h-5 w-5"})})}),$&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-20 flex items-center justify-center p-4",children:(0,t.jsxs)(o.Zp,{className:"bg-white shadow-lg max-w-md w-full",children:[(0,t.jsx)(o.aR,{children:(0,t.jsx)(o.ZB,{className:"text-xl font-semibold",children:"Resumo do Pedido"})}),(0,t.jsxs)(o.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Valor total:"}),(0,t.jsx)("span",{className:"text-xl font-bold text-primary",children:(0,j.v)(w.amount)})]}),(0,t.jsx)(i.w,{}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h4",{className:"font-semibold text-foreground",children:"Itens do pedido:"}),(0,t.jsx)("ul",{className:"space-y-1 text-sm",children:a.map((e,s)=>{var a,r;return(0,t.jsxs)("li",{className:"flex justify-between",children:[(0,t.jsxs)("span",{className:"text-muted-foreground",children:[e.quantity,"x ",e.product.name]}),(0,t.jsx)("span",{className:"font-medium",children:(0,j.v)(e.quantity*((null==(r=e.details)||null==(a=r.selectedVariation)?void 0:a.option.price)||e.product.price))})]},s)})})]}),(0,t.jsx)(c.$,{onClick:()=>V(!1),className:"w-full mt-4",children:"Fechar"})]})]})}),(0,t.jsxs)(o.Zp,{className:"bg-red-600 shadow-lg text-white",ref:Z,children:[(0,t.jsx)(o.aR,{className:"border-b border-red-700",children:(0,t.jsx)(o.ZB,{className:"text-xl font-semibold",children:"Como pagar"})}),(0,t.jsx)(o.Wu,{className:"space-y-4",children:(0,t.jsxs)("ol",{className:"space-y-3 text-white",children:[(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-white text-red-600 flex items-center justify-center text-xs font-bold",children:"1"}),(0,t.jsx)("span",{children:"Abra o aplicativo do seu banco"})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-white text-red-600 flex items-center justify-center text-xs font-bold",children:"2"}),(0,t.jsx)("span",{children:'Selecione a op\xe7\xe3o "Pagar com PIX" ou "PIX Copia e Cola"'})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-white text-red-600 flex items-center justify-center text-xs font-bold",children:"3"}),(0,t.jsx)("span",{children:"Cole a chave PIX copiada acima"})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-white text-red-600 flex items-center justify-center text-xs font-bold",children:"4"}),(0,t.jsxs)("span",{children:["Confirme o pagamento no valor de ",(0,j.v)(w.amount)]})]}),(0,t.jsxs)("li",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"flex-shrink-0 w-5 h-5 rounded-full bg-white text-red-600 flex items-center justify-center text-xs font-bold",children:"5"}),(0,t.jsx)("span",{children:"Aguarde a confirma\xe7\xe3o (geralmente instant\xe2nea)"})]})]})})]}),"approved"===A&&(0,t.jsx)(o.Zp,{className:"bg-success/5 border-success",children:(0,t.jsxs)(o.Wu,{className:"text-center space-y-4 p-6",children:[(0,t.jsx)("div",{className:"bg-success/10 p-4 rounded-full inline-block",children:(0,t.jsx)(x.A,{className:"h-12 w-12 text-success"})}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-success",children:"Pagamento Confirmado!"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Seu pedido foi pago com sucesso e est\xe1 sendo preparado."}),(0,t.jsx)(c.$,{onClick:J,className:"bg-success hover:bg-success/90 text-success-foreground",children:"Voltar para a p\xe1gina inicial"})]})}),"expired"===A&&(0,t.jsx)(o.Zp,{className:"bg-destructive/5 border-destructive",children:(0,t.jsxs)(o.Wu,{className:"text-center space-y-4 p-6",children:[(0,t.jsx)("div",{className:"bg-destructive/10 p-4 rounded-full inline-block",children:(0,t.jsx)(m,{className:"h-12 w-12 text-destructive"})}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-destructive",children:"QR Code Expirado"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"O tempo para pagar expirou. Por favor, fa\xe7a um novo pedido."}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.$,{onClick:_,className:"w-full",children:"Tentar novamente"}),(0,t.jsx)(c.$,{onClick:J,variant:"outline",className:"w-full",children:"Voltar para o in\xedcio"})]})]})})]})})})}},6474:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(2302).A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},6695:(e,s,a)=>{"use strict";a.d(s,{Wu:()=>i,ZB:()=>o,Zp:()=>l,aR:()=>c});var t=a(5155),r=a(2115),n=a(9434);let l=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("rounded-xl border bg-card text-card-foreground shadow",a),...r})});l.displayName="Card";let c=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});c.displayName="CardHeader";let o=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("font-semibold leading-none tracking-tight",a),...r})});o.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})}).displayName="CardDescription";let i=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",a),...r})});i.displayName="CardContent",r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter"},7762:(e,s,a)=>{Promise.resolve().then(a.bind(a,1474))}},e=>{var s=s=>e(e.s=s);e.O(0,[258,793,24,97,843,441,684,358],()=>s(7762)),_N_E=e.O()}]);